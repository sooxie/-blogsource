# 释放连接

##### 客户A 
##### 服务器B

- A的应用进程向其TCP发出释放连接的报文，并停止再发送数据，主动释放连接(FIN = 1, seq = u),进入FIN-WAIT-1(终止等待1),等待B的确认。FIN报文不携带数据，并消耗一个序号
- B收到连接释放报文段后发出确认报文（ACK = 1 ，seq = v, ack = u+1），B进入CLOSE-WAIT(关闭等待)状态。TCP处于**半关闭状态**, 即A没有数据要发送了，但B要发送数据,A仍要接收。
- A收到来自B的确认后，就进入FIN-WAIT-2(终止等待2)状态，等待B发送的连接释放报文段。
- B发送连接释放报文段（FIN = 1, seq = w ,ack = u+1）,B必须重复上次已经发送过的确认号ack = u+ 1。 B进入LAST-ACK(最后确认)状态，等待A的确认。
- A在收到B的连接释放报文段后，必须发出确认。确认报文段（ACK = 1, seq = u+1, ack = w+1）,然后进入TIME-WAIT（时间等待状态）,2MSL后才进入CLOSED状态。
  

 MSL: **最长报文段寿命(Maximum Segment LifeTime)**。TCP允许不同的实现可根据具体情况设置不同的MSL。

 #### A在TIME-WAIT必须等待2MSL

- 为了保证A发送的最后一个ACK报文段能够达到B。